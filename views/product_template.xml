<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <record id="e_sublimation_inherit_product_template" model="ir.ui.view">
        <field name="name">product.template.view.form.inherit</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_only_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//label[@for='sale_ok']" position="after">
                <field name="sublimation_ok" />
                <label for="sublimation_ok"/>
            </xpath>
            <xpath expr="//page[@name='general_information']" position="after">
                <page string="Sublimations" name="sublimations" invisible="not sublimation_ok or not id">
                    <div class="oe_button_box mb-2" name="button_box">
                        <button name="action_open_sublimation_wizard" type="object" class="btn btn-primary">
                            Create Sublimation
                        </button>
                    </div>
                    <field name="product_prod_sublimation_ids" mode="kanban" context="{'product_tmpl_sublimation_id': id,'default_sublimation_ok': sublimation_ok}">
                        <kanban quick_create="true" create="true" edit="true" limit="20">
                            <field name="currency_id"/>
                            <templates>
                                <t t-name="kanban-box" >
                                    <div class="card h-100 border shadow-0">
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="card-body d-flex flex-column justify-content-between ps-0 p-3">
                                                    <div class="mb-2">
                                                        <h6 class="mb-1 text-start">
                                                            <span t-if="record.default_code.value" class="text-muted fw-normal">
                                                                [<field name="default_code"/>]
                                                            </span>
                                                            <br/>
                                                            <field name="name"/>
                                                        </h6>
                                                    </div>

                                                    <div class="row g-2 text-muted small pt-3">
                                                        <div class="col-12 text-start">
                                                            <i class="fa fa-tag me-1" title="price"></i>
                                                            <field name="list_price" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="card-img-rigth text-end p-1">
                                                    <field
                                                        name="image_1920"
                                                        widget="image"
                                                        alt="Product"
                                                        options="{'img_class': 'img-fluid rounded', 'width': 25, 'height': 25}"
                                                    />
                                                </div>
                                            </div>
                                        </div>
                                        
                                        
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                        
                    </field>
                </page>
            </xpath>

            <button name="action_open_documents" position="before">
                <button name="action_open_product_product_sublimation" type="object"
                    icon="fa-sitemap" class="oe_stat_button"
                    invisible="not product_sublimation_count">
                    <field string="Sublimation" name="product_sublimation_count" widget="statinfo" />
                </button>
            </button> 
        </field>
    </record>

    <record id="stock.product_template_action_product" model="ir.actions.act_window">
        <field name="domain" eval="[('product_tmpl_sublimation_id', '=', False)]"/>
    </record>

    <record id="product_template_view_kanban_sublimation" model="ir.ui.view">
        <field name="name">product.template.kanban.sublimation</field>
        <field name="model">product.template</field>
        <field name="arch" type="xml">
            <kanban sample="1">
                <field name="currency_id"/>
                <field name="categ_id"/>
                <field name="product_sublimation_count" />
                <templates>
                    <t t-name="menu">
                        <div name="card_menu_view">
                            <div role="menuitem">
                                <div class="text-center">
                                    <a class="h6 link" name="action_open_product_template" type="object"><small>Open Product</small></a>
                                </div>
                            </div>
                        </div>
                    </t>
                    <t t-name="card" >
                        <a class="text-decoration-none text-reset h-100" name="action_open_product_product_sublimation_kanban" type="object">
                            <div class="card h-100 border-0 shadow-0">
                                <div class="card-img-top text-center p-2">
                                    <field
                                        name="image_1920"
                                        widget="image"
                                        alt="Product"
                                        options="{'img_class': 'img-fluid rounded', 'max_width': 192, 'max_height': 192}"
                                    />
                                </div>
                                
                                <div class="card-body d-flex flex-column justify-content-between p-3">
                                    <div class="mb-2">
                                        <h2 class="mb-1 text-truncate text-center">
                                            <span t-if="record.default_code.value" class="text-muted fw-normal">
                                                [<field name="default_code"/>]
                                            </span>
                                            <field name="name"/>
                                        </h2>
                                    </div>

                                    <div class="row g-2 text-muted small text-center">
                                        <div t-if="record.product_variant_count.value &gt; 1" class="col">
                                            <i class="fa fa-layer-group me-1" title="var"></i>
                                            <field name="product_variant_count"/> Variants
                                        </div>
                                        <div class="col">
                                            <i class="fa fa-sitemap me-1" title="subl"></i>
                                            <field name="product_sublimation_count"/>
                                        </div>
                                        <div class="col">
                                            <i class="fa fa-tag me-1" title="price"></i>
                                            <field name="list_price" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="product_template_view_list_sublimation" model="ir.ui.view">
        <field name="name">product.template.list.sublimation</field>
        <field name="model">product.template</field>
        <field name="arch" type="xml">
            <list js_class="ptmpl_sublimation_list">
                <field name="name" />
                <field name="default_code" />
                <field name="list_price" />
                <field name="product_sublimation_count" />
            </list>
        </field>
    </record>


    <record id="action_product_template_sublimation" model="ir.actions.act_window">
        <field name="name">Sublimated Products</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">kanban,list</field>
        <field name="domain">[('sublimation_ok','=',True),('product_tmpl_sublimation_id', '=', False)]</field>
        <field name="context">{'default_sublimation_ok':True}</field>
        <field name="help" type="html">
            <p/>
        </field>
    </record>

    <record id="ref_action_pt_kanban_sublimation" model="ir.actions.act_window.view">
        <field name="sequence" eval="0" />
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="product_template_view_kanban_sublimation"/>
        <field name="act_window_id" ref="action_product_template_sublimation"/>
    </record>
    <record id="ref_action_pt_list_sublimation" model="ir.actions.act_window.view">
        <field name="sequence" eval="1" />
        <field name="view_mode">list</field>
        <field name="view_id" ref="product_template_view_list_sublimation"/>
        <field name="act_window_id" ref="action_product_template_sublimation"/>
    </record>
    
    
</odoo>