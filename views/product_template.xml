<?xml version='1.0' encoding='utf-8'?>
<odoo>
    <record id="e_sublimation_inherit_product_template" model="ir.ui.view">
        <field name="name">product.template.view.form.inherit</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="product.product_template_only_form_view"/>
        <field name="arch" type="xml">
            <xpath expr="//label[@for='sale_ok']" position="after">
                <field name="sublimation_ok" />
                <label for="sublimation_ok"/>
            </xpath>
            <xpath expr="//page[@name='general_information']" position="after">
                <page string="Sublimaciones" name="sublimations" invisible="not sublimation_ok or not id">
                    <field name="sublimation_ids" mode="kanban" context="{'default_product_tmpl_id': id}">
                        <kanban quick_create="true" create="true" edit="true">
                            <field name="name"/>
                            <field name="image"/>
                            <templates>
                                <t t-name="kanban-box">
                                    <div class="oe_kanban_card" style="text-align: center;">
                                        <img alt="Img" t-att-src="kanban_image('sublimation.sublimation', 'image', record.id.raw_value)" 
                                            class="img-fluid"/>
                                        <div class="oe_kanban_details">
                                            <strong><field name="name"/></strong>
                                        </div>
                                    </div>
                                </t>
                            </templates>
                        </kanban>
                    </field>
                </page>
            </xpath>

            <button name="action_open_documents" position="before">
                <button name="action_open_product_product_sublimation" type="object"
                    icon="fa-sitemap" class="oe_stat_button"
                    invisible="not product_sublimation_count">
                    <field string="Sublimaciones" name="product_sublimation_count" widget="statinfo" />
                </button>
            </button>
        </field>
    </record>

    <record id="stock.product_template_action_product" model="ir.actions.act_window">
        <field name="domain" eval="[('sublimation_id', '=', False)]"/>
    </record>

    <record id="product_template_view_kanban_sublimation" model="ir.ui.view">
        <field name="name">product.template.kanban.sublimation</field>
        <field name="model">product.template</field>
        <field name="arch" type="xml">
            <kanban sample="1">
                <field name="currency_id"/>
                <field name="categ_id"/>
                <field name="product_sublimation_count" />
                <templates>
                    <t t-name="menu">
                        <div name="card_menu_view">
                            <div role="menuitem">
                                <a class="h6" name="action_open_product_template" type="object"><small>Abrir Producto</small></a>
                            </div>
                        </div>
                    </t>
                    <t t-name="card" >
                        <a class="text-decoration-none text-reset h-100" name="action_open_sublimation_kanban" type="object">
                            <div class="card h-100 border-0 shadow-0">
                                <div class="card-img-top text-center p-2">
                                    <field
                                        name="image_1920"
                                        widget="image"
                                        alt="Product"
                                        options="{'img_class': 'img-fluid rounded', 'max_width': 192, 'max_height': 192}"
                                    />
                                </div>
                                
                                <div class="card-body d-flex flex-column justify-content-between p-3">
                                    <div class="mb-2">
                                        <h2 class="mb-1 text-truncate text-center">
                                            <span t-if="record.default_code.value" class="text-muted fw-normal">
                                                [<field name="default_code"/>]
                                            </span>
                                            <field name="name"/>
                                        </h2>
                                    </div>

                                    <div class="row g-2 text-muted small">
                                        <div class="col-12 col-md-4">
                                            <i class="fa fa-tag me-1" title="price"></i>
                                            <field name="list_price" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                        </div>
                                        <div class="col-12 col-md-4">
                                            <t t-if="record.product_variant_count.value &gt; 1">
                                                <i class="fa fa-layer-group me-1" title="var"></i>
                                                <field name="product_variant_count"/> Variantes
                                            </t>
                                        </div>
                                        <div class="col-12 col-md-4">
                                            <i class="fa fa-sitemap me-1" title="subl"></i>
                                            <field name="product_sublimation_count"/> Subl.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>

    <record id="product_template_view_list_sublimation" model="ir.ui.view">
        <field name="name">product.template.list.sublimation</field>
        <field name="model">product.template</field>
        <field name="arch" type="xml">
            <list js_class="sublimation_list">
                <field name="name" />
                <field name="default_code" />
                <field name="list_price" />
                <field name="product_sublimation_count" />
            </list>
        </field>
    </record>


    <record id="action_product_template_sublimation" model="ir.actions.act_window">
        <field name="name">Productos Sublimados</field>
        <field name="res_model">product.template</field>
        <field name="view_mode">kanban,list</field>
        <field name="domain">[('sublimation_ok','=',True),('sublimation_id', '=', False)]</field>
        <field name="context">{'default_sublimation_ok':True}</field>
        <field name="help" type="html">
            <p/>
        </field>
    </record>

    <record id="ref_action_pt_kanban_sublimation" model="ir.actions.act_window.view">
        <field name="sequence" eval="0" />
        <field name="view_mode">kanban</field>
        <field name="view_id" ref="product_template_view_kanban_sublimation"/>
        <field name="act_window_id" ref="action_product_template_sublimation"/>
    </record>
    <record id="ref_action_pt_list_sublimation" model="ir.actions.act_window.view">
        <field name="sequence" eval="1" />
        <field name="view_mode">list</field>
        <field name="view_id" ref="product_template_view_list_sublimation"/>
        <field name="act_window_id" ref="action_product_template_sublimation"/>
    </record>
    
    
</odoo>